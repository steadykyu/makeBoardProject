# 정의

페이징이란 한 화면에서 보여주는 데이터의 범위를 결정하는 일련의 방법을 말한다.

# why? 페이징

우리가 흔히 접하는 일반적인 웹 게시판이나 조회 화면을 생각하면 된다. 조회 대상 데이터가 10만 건이라면 한 화면에서 모두 보여 줄 수는 없다. 이때 한 화면에서 보여줄 수 있는 범위를 결정하는 것이 페이징이다.

# 페이징의 역사

> Fetch

경로 추가하기.

https://github.com/steadykyu/makeBoardProject/blob/master/%EC%95%8C%EA%B2%8C%EB%90%9C%EC%A0%90_%EC%88%98%EC%A0%95%ED%9B%84_TIL%

과거에는 클라이언트/서버 환경에서의 개발이 주를 이루었다. 그러므로 DB연결을 유지한 상태에서 결과 데이터를 계속해서 Fetch(http 요청) 할 수 있었다. 그러므로 초기에는 프로그램 소스에서 페이징 처리를 구현하는 프로그램 페이징 방법이 있었다.

그러나 웹이 도입되면서 DB연결을 유지한 상태에서 결과 데이터를 컨트롤 할수 없게 되었다. 따라서 개발자는 개별적인 SQL문을 반복 수행하는 방법으로 페이징 처리를 구현하였다.

이전의 프로그램 페이징은 페이지 조회에 더 많은 Fetch를 발생시켰기 때문에, 이제는 서버단에서 페이징을 구현하고 프로그램 단에서는 실제 화면에 뿌려질 데이터만 Fetch하는 방법이 일반적이게 되었다.
서버 페이징 처리는 단순하게 쿼리 페이징 처리라고 생각하면 쉽다. 즉 서버 단에서 페이징 처리를 구현한다는 의미는 쿼리문안에서 페이징 처리를 구현한다는 의미와 동일하다.

> MySQL Limit

```sql
SELECT * FROM 고객

WHERE 고객명 = ?

ORDER BY 등록일시 DESC

LIMIT 21 AND 10
```

> Oracle

```sql
SELECT A.* FROM

(

SELECT *, ROW_NUMBER() OVER(ORDER BY 등록일시 DESC) AS NUM

FROM 고객 WHERE 고객명 = ?

) A

WHERE NUM BETWEEN 21 AND 30
```

# 전체 범위 페이징과 부분 범위 페이징 처리

서버 페이지은 전체 범위 페이징과 부분 범위 페이징 처리로 나눌수 있다. 이를 이해 하기 위해서는 전체 범위 와 부분 범위를 알고 있어야한다.

```sql
[전체 범위 조회]

SELECT * FROM 고객
```

```sql
[부분 범위 조회]

SELECT * FROM 고객

WHERE ROWNUM <= 10
```

```sql
[부분 범위 조회 혹은 전체 범위 조회]

SELECT * FROM 고객

WHERE 고객명 = ‘홍길동’

ORDER BY 고객번호
```

고객 테이블 부분 범위를 조회하거나 전체 범위를 조회하는 쿼리이다. 만약 조건절로 사용하는 고객명 컬럼에 인덱스가 있다면 부분 범위 조회를 한다. 반면에 고객명 컬럼에 인덱스가 없다면 전체 범위 조회를 한다.

> 비 효율적인 페이징 처리 쿼리 예시

```sql
[부분 범위 조회 혹은 전체 범위 조회]

SELECT * FROM

(

SELECT * FROM 고객 ORDER BY 고객번호

)

WHERE ROWNUM <= 10
```

고객 테이블 부분 범위를 조회하거나 전체 범위를 조회하는 쿼리이다. 만약 ORDER BY 절로 사용하는 고객번호 컬럼에 인덱스가 있다면 부분 범위 조회를 한다.

반면에 고객번호 컬럼에 인덱스가 없다면 전체 범위 조회를보여줄 수 있는 한 페이지 분량의 데이터를 조회하는 것을 말한다. 전체 범위 페이징 처리는 많은 데이터를 조회하지만 극히 일부분만 실제로 화면에 표시하는 데에 사용하므로 아주 비효율적인 페이징 처리 방법이다. 한 페이지 분량의 데이터만 필요함에도 화면에 보이지도 않을 전체 데이터를 불필요하게 조회하므로 성능에 나쁜 영향을 미친다.

이렇게 인덱스 유무에 따라 페이징의 처리가 달라지게 된다.

> 전체 범위 페이징 처리

```sql
SELECT B.* FROM

(

SELECT A.*, ROWNUM AS NUM FROM

(

SELECT * FROM 고객 ORDER BY 등록일시 DESC

) A

) B

WHERE NUM BETWEEN ? AND ?
```

> 부분 범위 페이징 처리

```sql
SELECT B.* FROM

(

SELECT A.*, ROWNUM AS NUM FROM

(

SELECT * FROM 고객 WHERE 고객명 = ? ORDER BY 등록일시 DESC

) A

WHERE ROWNUM < = ? // (페이지번호 * 페이지크기)

) B

WHERE NUM >= ? // ((페이지번호 - 1) * 페이지크기 + 1)
```

(조건절에 있는 고객명 컬럼은 인덱스 있음).

부분 범위 페이징 처리는 실제로 화면에 표시 하는 데에 필요한 분량만큼의 데이터를 조회해서 처리하므로 아주 효율적인 페이징 처리 방법이다. 화면에 보여줄 필요한 분량만큼만 조회해야 하므로 인덱스와 밀접한 관계가 있고 인덱스를 적절히 잘 활용하여야 한다.

# 최고의 페이징 처리와 최적의 페이징 처리

필자도 고민을 많이 했으나 최고의 성능을 내는 가장 좋은 페이징 처리 방법은 존재하지 않음을 알았다. 단지 여러 물리적 상황과 프로젝트 여건 등 업무적 협의를 통해 성능 이슈가 발생하지 않도록 가장 적합한 페이징 방법을 찾아야 한다.

인덱스를 활용한 부분 범위 페이징 처리뿐만 아니라 고객과의 업무 협의를 통한 화면 인터페이스 변경만으로도 충분한 효과를 볼 수 도 있다. 최고의 페이징 처리 방법을 찾을 것이 아니라 상황에 맞는 최적의 페이징 처리 구현을 목표로 삼아야 한다.

출처 : https://dataonair.or.kr/home/%eb%8d%b0%ec%9d%b4%ed%84%b0-%ea%b4%91%ec%9e%a5/%eb%8d%b0%ec%9d%b4%ed%84%b0-%ec%9d%b8%ec%82%ac%ec%9d%b4%ed%8a%b8/%eb%8d%b0%ec%9d%b4%ed%84%b0-%ec%a0%84%eb%ac%b8%ea%b0%80-%ec%b9%bc%eb%9f%bc/?mod=document&uid=7#:~:text=%ED%8E%98%EC%9D%B4%EC%A7%95%EC%9D%B4%EB%9E%80%20%ED%95%9C%20%ED%99%94%EB%A9%B4%EC%97%90%EC%84%9C,%EB%B3%B4%EC%97%AC%20%EC%A4%84%20%EC%88%98%EB%8A%94%20%EC%97%86%EB%8B%A4.
